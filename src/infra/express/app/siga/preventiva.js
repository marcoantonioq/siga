import ky from "ky";

const request = ky.create({ retry: { limit: 5 }, timeout: 60000 });

export async function preventiva({ token, date1, date2 }) {
  try {
    let pagina = 0;
    const tamanho = 100; // pode ser 10, 50, 100, depende do limite da API
    const todos = [];

    while (true) {
      const response = await request.post(
        "https://siga-api.congregacao.org.br/api/mnt/mnt003/dados/tabela",
        {
          json: {
            filtro: {
              codigoTipoChecklist: null,
              codigoEstabelecimento: null,
              dataIni: date1,
              dataFim: date2,
              status: [0, 3],
              pesquisaRapida: "",
            },
            paginacao: {
              paginaAtual: pagina,
              quantidadePorPagina: tamanho,
              ordenarPor: null,
              ordenarDirecao: null,
            },
          },
          headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json",
            Accept: "application/json, text/plain, */*",
          },
        }
      ).json();

      const registros = response.dados || [];

      if (!registros.length) break; // acabou
      todos.push(...registros);

      console.log(
        `Página ${pagina} carregada com ${registros.length} registros`
      );

      if (registros.length < tamanho) break; // última página
      pagina++;
    }
    console.log(`\nTotal preventiva coletado: ${todos.length} registros\n`);
    return todos;
  } catch (error) {
    console.error("Erro na requisição:", error.message);
    return [];
  }
}

preventiva({
  token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJDbGFpbXMuQ29kaWdvRW1wcmVzYSI6IjEzMyIsIkNsYWltcy5Ob21lRXhpYmljYW9FbXByZXNhIjoiRkFJTkEiLCJDbGFpbXMuQ29kaWdvVXN1YXJpbyI6IjM4NTk4OCIsIkNsYWltcy5Mb2dpblVzdWFyaW8iOiJuYXlhcmEucXVlaXJveiIsIkNsYWltcy5Ob21lVXN1YXJpbyI6Ik5BWUFSQSBCRU5UTyBEQSBTSUxWQSBRVUVJUk9aIiwiQ2xhaW1zLkNvZGlnb0VzdGFiZWxlY2ltZW50byI6IjM4MiIsIkNsYWltcy5Ob21lRXhpYmljYW9Fc3RhYmVsZWNpbWVudG8iOiJBRE0gLSBGQUlOQSAtIEdPIiwiQ2xhaW1zLkNvZGlnb0VzdGFiZWxlY2ltZW50b0Zpc2NhbCI6IjM4MiIsIkNsYWltcy5Db2RpZ29BY2Vzc28iOiJjOWI1NDI3Yi1kNzBhLTRjMzAtODRiNi1lYzlkN2UzNmEwMjYiLCJDbGFpbXMuQ29kaWdvQ29tcGV0ZW5jaWEiOiJlYWVkZDMxNi1lNmVkLTQ5MmItOGEzMC1iMjJhZDFmNmFhYmYiLCJDbGFpbXMuTm9tZUV4aWJpY2FvQ29tcGV0ZW5jaWEiOiIwOC8yMDI1IiwiQ2xhaW1zLkFjZXNzb0dsb2JhbCI6IkZhbHNlIiwiQ2xhaW1zLkNvZGlnb0lkaW9tYSI6IjEiLCJDbGFpbXMuU2lnbGFJZGlvbWEiOiJwdC1CUiIsIkNsYWltcy5TaWdsYUlkaW9tYUVtcHJlc2EiOiJwdC1CUiIsIkNsYWltcy5TaW1ib2xvTW9lZGEiOiJSJCIsIkNsYWltcy5Db2RpZ29QYWlzIjoiMTA1OCIsIkNsYWltcy5OdW1lcm9SZWdpc3Ryb1BvclBhZ2luYSI6IjEwIiwiQ2xhaW1zLkNvZGlnb1RpcG9Fc3RhYmVsZWNpbWVudG8iOiIzIiwiQ2xhaW1zLkRhdGFJbmljaWFsQ29tcGV0ZW5jaWEiOiIyMDI1LTA4LTAxIiwiQ2xhaW1zLkRhdGFGaW5hbENvbXBldGVuY2lhIjoiMjAyNS0wOC0zMSIsIkNsYWltcy5Db2RpZ29Fc3RhZG8iOiI1MiIsIkNsYWltcy5Db2RpZ29QYWlzUmVsYXRvcmlvIjoiMSIsIkNsYWltcy5UZWNuaWNvIjoiRmFsc2UiLCJDbGFpbXMuRXN0YWJlbGVjaW1lbnRvU2VkZVJSTSI6IkZhbHNlIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9yb2xlIjpbIkNUQjAwMzAxIiwiQ1RCMDAzMDMiLCJDVEIwMDMwNCIsIkNUQjAwMzA1IiwiQ1RCMDAzMDYiLCJDVEIwMDMwNyIsIkNUQjAwMzA4IiwiQ1RCMDAzMDkiLCJDVEIwMDMxMCIsIkNUQjAwMzExIiwiQ1RCMDAzMTIiLCJDVEIwMDMxMyIsIkNUQjAwMzE0IiwiQ1RCMDAzMTUiLCJDVEIwMDMxNiIsIkNUQjAwMzE3IiwiQ1RCMDAzMTgiLCJDVEIwMDMxOSIsIkNUQjAwMzIwIiwiQ1RCMDAzMjEiLCJDVEIwMDMyMiIsIkNUQjAwMzIzIiwiQ1RCMDAzMjQiLCJDVEIwMDMyNSIsIkNUQjAwMzI2IiwiQ1RCMDAzMjciLCJDVEIwMDQwMSIsIkNUQjAwNDAzIiwiQ1RCMDA3MDEiLCJDVEIwMDcwNCIsIkNUQjAwNzA3IiwiQ1RCMDA3MDgiLCJDVEIwMDcwOSIsIkNUQjAwNzEwIiwiQ1RCMDA3MTEiLCJDVEIwMDcxMiIsIkNUQjAwNzEzIiwiQ1RCMDA3MjAiLCJDVEIwMDcyMSIsIkNUQjAwNzIyIiwiQ1RCMDA3MjMiLCJDVEIwMDcyNCIsIkNUQjAwNzI1IiwiQ1RCMDA3MjYiLCJDVEIwMDcyNyIsIkNUQjAwNzI4IiwiQ1RCMDA3MjkiLCJDVEIwMDczMCIsIkNUQjAwNzMzIiwiQ1RCMDA3MzUiLCJDVEIwMDczNiIsIkNUQjAwNzM3IiwiQ1RCMDA3MzgiLCJDVEIwMDczOSIsIkNUQjAwNzQwIiwiQ1RCMDA3NDEiLCJDVEIwMDc0MyIsIkNUQjAwNzQ0IiwiQ1RCMDA3NDUiLCJDVEIwMDc0OCIsIkNUQjAwNzQ5IiwiQ1RCMDA4MDEiLCJDVEIwMDgwMiIsIkNUQjAwOTAxIiwiQ1RCMDA5MDIiLCJDVEIwMDkwMyIsIkNUQjAxMDAxIiwiQ1RCMDEwMDIiLCJDVEIwMTAwMyIsIkNUQjAxMDA0IiwiQ1RCMDEwMDUiLCJDVEIwMTEwMSIsIkNUQjAxMTAyIiwiQ1RCMDEyMDEiLCJDVEIwMTIwMiIsIkNUQjAxMzAxIiwiQ1RCMDEzMDIiLCJDVEIwMTQwMSIsIkNUQjAxNDAyIiwiQ1RCMDE1MDEiLCJDVEIwMTUxMSIsIkNUQjAxNTIxIiwiQ1RCMDE1MzAiLCJDVEIwMTUzMSIsIkNUQjAxNTMyIiwiQ1RCMDE1MzMiLCJDVEIwMTUzNCIsIkNUQjAxNTM1IiwiQ1RCMDIwMDEiLCJDVEIwMjAwMiIsIkNUQjAyMDAzIiwiQ1RCMDIwMDQiLCJDVEIwMjAwNSIsIkNUQjAyMTAxIiwiQ1RCMDIxMDIiLCJDVEIwMjIwMSIsIkNUQjAyMjAyIiwiQ1RCMDMwMDEiLCJDVEIwMzEwMSIsIkNUQjAzMTAyIiwiQ1RCMDMxMDMiLCJDVEIwMzQwMSIsIkNUQjAzNTAxIiwiQ1RCMDM1MDIiLCJDVEIwMzUwMyIsIkNUQjA0MDAxIiwiQ1RCMDQwMDIiLCJDVEIwNDEwMSIsIkVBRDAwMTAxIiwiRU5HMDAyMDEiLCJFTkcwMDIwMiIsIkVORzAwMjAzIiwiRU5HMDAyMDQiLCJFTkcwMDIwNSIsIkVORzAwMjA2IiwiRU5HMDAyMDciLCJFU1QwMDUwMSIsIkVTVDAwNTAzIiwiRVNUMDA1MDQiLCJFU1QwMDgwMSIsIkVTVDAwODAyIiwiRVNUMDA5MDEiLCJFU1QwMDkwMiIsIkVTVDAwOTAzIiwiRVNUMDEyMDEiLCJFU1QwMTIwOCIsIkVTVDAxNTE1IiwiRVNUMDIwMDEiLCJFU1QwMjAwMiIsIkVTVDAyMjAxIiwiRVNUMDIyMDIiLCJFU1QwMjIwMyIsIkVTVDAyMjA1IiwiRVNUMDIyMDYiLCJFU1QwMjIwNyIsIkVTVDAyMjA4IiwiRVNUMDIyMDkiLCJFU1QwMjIxMSIsIkVTVDAyMjEzIiwiRVNUMDIyMTQiLCJFU1QwMjIxOSIsIkVTVDAyMjIwIiwiRVNUMDIyMjEiLCJFU1QwMjIyOSIsIkVTVDAyMjMzIiwiRVNUMDIyMzkiLCJFU1QwMjI0MiIsIkVTVDAyMjQ0IiwiRVNUMDIyNDUiLCJFU1QwMjI0NiIsIkVTVDAyMjQ3IiwiRVNUMDIyNTAiLCJFU1QwMjYwMSIsIkVTVDAyNjAyIiwiRVNUMDI2MDMiLCJFU1QwMjYwNyIsIkVTVDAyNjA5IiwiRVNUMDI2MTMiLCJFU1QwMjYxNSIsIkVTVDAyNjE2IiwiRVNUMDI3MDEiLCJFU1QwMjcwMiIsIkVTVDAyNzAzIiwiRVNUMDI3MDQiLCJFU1QwMjcwNSIsIkVTVDAyNzA2IiwiRVNUMDI3MDciLCJFU1QwMjcwOCIsIkVTVDAyNzExIiwiRVNUMDI3MTIiLCJFU1QwMjcxNiIsIkVTVDAyNzE4IiwiRVNUMDI3MTkiLCJFU1QwMjcyMCIsIkVTVDAyODAxIiwiRVNUMDI4MDYiLCJFU1QwMjgwNyIsIkVTVDAyODExIiwiRVNUMDI4MTIiLCJFU1QwMjkwMSIsIkVTVDAyOTA1IiwiRVNUMDI5MDgiLCJFU1QwMjkwOSIsIkVTVDAyOTExIiwiRVNUMDI5MTUiLCJFU1QwMjkyMCIsIkVTVDAzMDAxIiwiRVNUMDMwMDIiLCJFU1QwMzAwMyIsIkVTVDAzNjAxIiwiRVNUMDM2MDIiLCJFU1QwNDEwMSIsIkVTVDA0MTAyIiwiRVNUMDQyMDEiLCJFU1QwNDIwMiIsIkVTVDA0NDAxIiwiRVNUMDQ0MDIiLCJFU1QwNDQwNiIsIkVTVDA0NDA3IiwiRVNUMDQ0MDkiLCJFU1QwNDQxNiIsIkVTVDA0NDE5IiwiRVNUMDQ0MjMiLCJFU1QwNDYwMSIsIkVTVDA0NjAyIiwiRVNUMDQ2MDMiLCJFU1QwNDYwNCIsIklORjAwMTAxIiwiSU5GMDAyMDEiLCJNTlQwMDIwMSIsIk1OVDAwMjAyIiwiTU5UMDAyMDMiLCJNTlQwMDIwNCIsIk1OVDAwMjA1IiwiTU5UMDAyMDciLCJNTlQwMDIwOCIsIk1OVDAwMjA5IiwiTU5UMDAyMTAiLCJNTlQwMDMwMSIsIk1OVDAwMzAyIiwiTU5UMDAzMDMiLCJNTlQwMDQwMSIsIk1OVDAwNDAyIiwiTU5UMDA0MDMiLCJNTlQwMDQwNCIsIk1OVDAwNDA1IiwiTU5UMDA0MDYiLCJNTlQwMDQwNyIsIlBUUjAwNzAxIiwiUFRSMDA3MDMiLCJQVFIwMDcwNCIsIlBUUjAwNzA1IiwiUFRSMDA3MDYiLCJQVFIwMDcwOCIsIlBUUjAwODAxIiwiUFRSMDA4MDIiLCJQVFIwMDgwMyIsIlBUUjAwODA1IiwiUFRSMDA4MDYiLCJQVFIwMDgwNyIsIlBUUjAwOTAxIiwiUFRSMDA5MDMiLCJQVFIwMTAwMSIsIlBUUjAxMDAyIiwiUFRSMDEwMDMiLCJQVFIwMTAwNCIsIlBUUjAxMDA1IiwiUFRSMDEwMDYiLCJQVFIwMTEwMSIsIlBUUjAxMTAyIiwiUFRSMDEyMDEiLCJQVFIwMTIwMiIsIlJFTDAwNDAxIiwiUkVMMDA0MDIiLCJSRUwwMDQwMyIsIlJFTDAwNDA0IiwiUkVMMDA0MDUiLCJSRUwwMDQxMCIsIlJFTDAwNDExIiwiUkVMMDA0MTIiLCJSRUwwMDQxMyIsIlJFTDAwNDE0IiwiUkVMMDA0MTUiLCJSRUwwMTAwMSIsIlJFTDAxMDEwIiwiUkVMMDEwMTEiLCJSRUwwMTAxMiIsIlJFTDAxMDEzIiwiUkVMMDEwMTQiLCJSRUwwMTAxNyIsIlJFTDAxMDE4IiwiUkVMMDEwNDEiLCJSRUwwMTA0MyIsIlJFTDAxMDU3IiwiUkVMMDE3MDEiLCJSRUwwMTcwNiIsIlJFTDAxNzA4IiwiUkVMMDI1MDEiLCJSRUwwMjUwMyIsIlJFTDAyNTA0IiwiUkVMMDMzMDIiLCJSSDAwMjAxIiwiUkgwMDIwMyIsIlJIMDAyMDQiLCJSSDAwMjA1IiwiUkgwMDMwMSIsIlJIMDAzMDMiLCJSSDAwNDAxIiwiUkgwMDQwMyIsIlJIMDA0MDYiLCJSSDAwNTAxIiwiUkgwMDUwMyIsIlNJUzk5OTE5IiwiU0lTOTk5MjAiLCJURVMwMDIwMSIsIlRFUzAwNDAxIiwiVEVTMDA0MDQiLCJURVMwMDUwMSIsIlRFUzAwNTA2IiwiVEVTMDA1MDciLCJURVMwMDYwMSIsIlRFUzAwNjA0IiwiVEVTMDA3MDEiLCJURVMwMDcwMiIsIlRFUzAwODAxIiwiVEVTMDA4MDIiLCJURVMwMDgwMyIsIlRFUzAwODA0IiwiVEVTMDA5MDEiLCJURVMwMDkwMiIsIlRFUzAwOTAzIiwiVEVTMDEyMDEiLCJURVMwMTIwMiIsIlRFUzAxMzAxIiwiVEVTMDEzMDIiLCJURVMwMTMwMyIsIlRFUzAxMzA0IiwiVEVTMDEzMDUiLCJURVMwMTMwNiIsIlRFUzAxMzA3IiwiVEVTMDEzMDgiLCJURVMwMTMwOSIsIlRFUzAxMzEwIiwiVEVTMDEzMTMiLCJURVMwMTMxNCIsIlRFUzAxMzE1IiwiVEVTMDEzMTYiLCJURVMwMTMxNyIsIlRFUzAxMzE4IiwiVEVTMDEzMTkiLCJURVMwMTMyMCIsIlRFUzAxMzIxIiwiVEVTMDEzMjIiLCJURVMwMTMyMyIsIlRFUzAxNDAxIiwiVEVTMDE0MDMiLCJURVMwMTQwNSIsIlRFUzAxNDA2IiwiVEVTMDE1MDEiLCJURVMwMTUwMiIsIlRFUzAxNTAzIiwiVEVTMDE1MDQiLCJURVMwMTUwNSIsIlRFUzAxNTA2IiwiVEVTMDE1MDciLCJURVMwMTUxMCIsIlRFUzAxNTExIiwiVEVTMDE1MTIiLCJURVMwMTUxMyIsIlRFUzAxNTE0IiwiVEVTMDE1MTUiLCJURVMwMTUxNiIsIlRFUzAxNTE5IiwiVEVTMDE1MjAiLCJURVMwMTcwMSIsIlRFUzAxNzAyIiwiVEVTMDE3MDMiLCJURVMwMTcwNCIsIlRFUzAxNzA1IiwiVEVTMDE3MDgiLCJURVMwMTcwOSIsIlRFUzAxNzEwIiwiVEVTMDE3MTEiLCJURVMwMTcxMiIsIlRFUzAxNzE0IiwiVEVTMDE3MTYiLCJURVMwMTcxNyIsIlRFUzAxNzE4IiwiVEVTMDE3MTkiLCJURVMwMTgwMSIsIlRFUzAxODAyIiwiVEVTMDE5MDEiLCJURVMwMTkwMiIsIlRFUzAyMTAxIiwiVEVTMDIxMDMiLCJURVMwMjEwNSIsIlRFUzAyMTA2IiwiVEVTMDIxMDgiLCJURVMwMjMwMSIsIlRFUzAyMzAyIiwiVEVTMDIzMDMiLCJURVMwMjMwNCIsIlRFUzAyMzA1IiwiVEVTMDIzMDYiLCJURVMwMjMwNyIsIlRFUzAyMzA4IiwiVEVTMDIzMDkiLCJURVMwMjMxMCIsIlRFUzAyNDAxIiwiVEVTMDI0MDIiLCJURVMwMjQwMyIsIlRFUzAyNDA0IiwiVEVTMDI0MDUiLCJURVMwMjQwNiIsIlRFUzAyNDA3IiwiVEVTMDI0MDgiLCJURVMwMjQwOSIsIlRFUzAyNTAxIiwiVEVTMDI1MDQiLCJURVMwMjUwNSIsIlRFUzAyNTA2IiwiVEVTMDI1MDciLCJURVMwMjUwOCIsIlRFUzAyNTEwIiwiVEVTMDI2MDEiLCJURVMwMjYwNCIsIlRFUzAyNjA1IiwiVEVTMDI2MDYiLCJURVMwMjYwNyIsIlRFUzAyNjA4IiwiVEVTMDI3MDEiLCJURVMwMjcwMiIsIlRFUzAyNzAzIiwiVEVTMDI3MDQiLCJURVMwMjcwNSIsIlRFUzAyNzA2IiwiVEVTMDI3MDciLCJURVMwMjcwOCIsIlRFUzAyOTAxIiwiVEVTMDI5MDIiLCJURVMwMzAwMSIsIlRFUzAzMDAyIiwiVEVTMDMxMDEiLCJURVMwMzEwMiIsIlRFUzAzMzAxIiwiVEVTMDMzMDIiLCJURVMwMzUwMSIsIlRFUzAzNTAyIiwiVEVTMDM1MDMiLCJURVMwMzUwNCIsIlRFUzAzNTA1IiwiVEVTMDM2MDEiLCJURVMwMzYwMiIsIlRFUzAzNjAzIiwiVEVTMDM2MDQiLCJURVMwMzcwMSIsIlRFUzAzNzAzIiwiVEVTMDM4MDEiLCJURVMwNDAwMSIsIlRFUzA0MDAyIiwiVEVTMDQzMDEiLCJURVMwNDMwMiIsIlRFUzA0MzAzIiwiVEVTMDQ1MDEiLCJURVMwNDUwMyIsIlRFUzA1MjAxIiwiVEVTMDUyMDQiLCJURVMwNTMwMSIsIlRFUzA1MzAyIiwiVEVTMDUzMDMiLCJURVMwNTMwNCIsIlRFUzA1NTAxIiwiVEVTMDU2MDEiLCJURVMwNTYwMiIsIlRFUzA1NjAzIiwiVEVTMDU2MDQiLCJWRVIwMDEwMSIsIlZFUjAwMjAxIiwiVkVSMDAyMDIiLCJWRVIwMDIwMyIsIlZFUjAwMjA0IiwiVkVSMDAyMDYiLCJWRVIwMDIwNyIsIlZFUjAwMjA4IiwiVkVSMDA4MDEiLCJWRVIwMDgwMiIsIlZFUjAwODAzIiwiVkVSMDA4MDQiLCJWRVIwMDgwNSIsIlZFUjAwODA2IiwiVkVSMDA4MDciLCJWRVIwMDgwOCIsIlZFUjAwODA5IiwiVkVSMDA4MTAiLCJWRVIwMDgxMSIsIlZFUjAwODEyIiwiVkVSMDA4MTMiLCJWRVIwMDkwMSIsIlZJQTAwMTAxIiwiVklBMDAxMDMiLCJWSUEwMDEwNiIsIlZJQTAwMTA3IiwiVklBMDAxMDkiLCJWSUEwMDExMiIsIlZJQTAwMTE0IiwiVklBMDAxMTYiLCJWSUEwMDExNyIsIlZJQTAwMTE4IiwiVklBMDAxMTkiLCJWSUEwMDEyMSIsIlZJQTAwMTIyIiwiVklBMDAxMjMiLCJWSUEwMDEyNCIsIlZJQTAwMTI1IiwiVklBMDAxMzAiLCJWSUEwMDEzMSJdLCJleHAiOjE3NTU3NDc2OTcsImlzcyI6Imh0dHBzOi8vc2lnYS1hcGkuY29uZ3JlZ2FjYW8ub3JnLmJyLyIsImF1ZCI6Imh0dHBzOi8vc2lnYS1hcGkuY29uZ3JlZ2FjYW8ub3JnLmJyLyJ9.K2_30z76vvZjWjRd7owK2gUHtmJFmm__JWPrTEobaiU',
  date1: '2025-01-01',
  date2: '2025-08-20'
})